#!/bin/bash

output_file="project_files.txt"
> "$output_file"

# Function to create a separator with file path
create_separator() {
    echo -e "\n=== FILE: $1 ===\n"
}

# Find files while excluding irrelevant directories and files
find . -type f \
    ! -path "*/node_modules/*" \
    ! -path "*/.git/*" \
    ! -path "*/dist/*" \
    ! -path "*/build/*" \
    ! -path "*/prisma/dev.db" \
    ! -path "*/prisma/migrations/*" \
    ! -path "*/.next/*" \
    ! -path "*/wiki.sqlite" \
    ! -path "*/project_files.txt" \
    ! -path "*/node_modules_list.txt" \
    ! -path "*/package-lock.json" \
    ! -name "*.old" \
    ! -name "*.old.old" \
    ! -name "*.bak" \
    ! -name "*.css" \
    \( -name "*.tsx" \
       -o -name "*.ts" \
       -o -name "*.js" \
       -o -name "*.json" \
       -o -name "*.prisma" \
       -o -name "Dockerfile" \
       -o -name "docker-compose.yml" \
       -o -name "*.txt" \
       -o -path "*/public/*" \
       -o -path "*/secret/*" \
    \) \
    -print0 | while IFS= read -r -d '' file; do
    create_separator "$file" >> "$output_file"
    cat "$file" >> "$output_file"
done

echo "Files have been compiled into $output_file"
